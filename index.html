<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZY: Cyber — Дизайн персонажа</title>
    <meta name="description" content="Интерактивный лист персонажа для настольной ролевой игры EZY: Cyber">
    
    <!-- Иконка сайта -->
    <link rel="icon" type="image/png" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    <link rel="shortcut icon" type="image/png" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    <link rel="apple-touch-icon" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    
    <!-- Подключение CSS стилей -->
    <link rel="stylesheet" href="styles.css?v=20250103&modules-redesign=1">
</head>
<body>
    <!-- Заглушка для мобильных устройств -->
    <div class="mobile-warning" id="mobileWarning" style="display: none;">
        <div class="mobile-warning-content">
            <div class="mobile-warning-icon">&#x1F4F1;</div>
            <h2 class="mobile-warning-title">Экран слишком мал</h2>
            <p class="mobile-warning-text">
                Данное приложение предназначено для использования на устройствах с большим экраном.
                <br><br>
                Пожалуйста, откройте страницу на компьютере, ноутбуке или планшете с экраном шириной от 1024px.
            </p>
            <div class="mobile-warning-specs">
                <div>Ваш экран: <span id="screenWidth">0</span>px</div>
                <div>Минимум: 1024px</div>
            </div>
        </div>
    </div>

    <!-- Загрузочный экран -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">EZY: CYBER // HUMAN_DESIGN [ПОЧТИRELEASE v0.99.999999]</div>
        <div class="loading-log" id="loadingLog">
            <div class="loading-log-item" id="logItem1"></div>
            <div class="loading-log-item" id="logItem2"></div>
            <div class="loading-log-item" id="logItem3"></div>
            <div class="loading-log-item" id="logItem4"></div>
            <div class="loading-log-item" id="logItem5"></div>
            <div class="loading-log-item" id="logItem6"></div>
        </div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="progressBar"></div>
            <div class="loading-progress-text" id="progressText">0%</div>
        </div>
    </div>
    <!-- Основной интерфейс -->
    <div class="main-interface" id="mainInterface">
        <!-- Заголовок -->
        <header class="header">
            <div class="header-title"><img src="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG" alt="🧬" style="width: 50px; height: 50px; margin-right: 0.5rem; vertical-align: middle;"> EZY: Cyber — Лист персонажа</div>
            <div class="header-controls">
                <button class="pill-button primary-button" onclick="exportData()">💾 Сохранить персонажа</button>
                <button class="pill-button muted-button" id="themeToggle" onclick="toggleTheme()" title="Переключить тему">🌙 СВЕТОВАЯ ПОШЛА</button>
                <button class="pill-button muted-button" onclick="importData()">&#x27F2; Импорт JSON</button>
                <button class="pill-button danger-button" onclick="clearAllData()">Очистить данные</button>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="main-content">

            <!-- Общая информация - полноширинный блок -->
            <div class="section full-width-section" id="generalInfoSection">
                <div class="section-header">
                    <h3 class="section-title"><img src="https://static.tildacdn.com/tild3634-6236-4031-b939-313937393365/resume.png" alt="🧠" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Общая информация</h3>
                </div>
                <div class="section-content expanded">
                    <!-- Главная сетка: Аватар слева, информация в центре -->
                    <div class="character-sheet-layout">
                        <!-- Аватар, кнопки, здоровье и деньги -->
                        <div class="avatar-section">
                            <div id="avatarDisplay" class="avatar-placeholder">
                                <!-- Аватар будет загружен здесь -->
                            </div>
                            <div class="avatar-controls">
                                <label class="pill-button muted-button avatar-button">
                                    &#x1F4F7; Загрузить фото
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;" />
                                </label>
                                <button class="pill-button muted-button avatar-button" id="removeAvatarButton"><img src="https://static.tildacdn.com/tild6166-3331-4338-b038-623539346365/x-button.png" alt="🗑️" style="width: 16px; height: 16px;"> Удалить</button>
                            </div>
                            
                            <!-- Пункты здоровья -->
                            <div class="health-box">
                                <div class="health-icon"><img src="https://static.tildacdn.com/tild6361-6133-4534-b338-616664333865/heart.png" alt="❤️"></div>
                                <div class="health-label">ПУНКТЫ ЗДОРОВЬЯ</div>
                                <div class="health-values">
                                    <input type="text" class="health-input" id="healthCurrent" value="25" min="0" onchange="state.health.current = parseInt(this.value); scheduleSave();">
                                    <span class="health-separator">/</span>
                                    <input type="text" class="health-input" id="healthMax" value="38" readonly>
                                </div>
                            </div>
                            
                            <!-- YenEuro -->
                            <div class="money-box">
                                <div class="money-icon"><img src="https://static.tildacdn.com/tild3939-6162-4633-a238-623334613265/photo.png" alt="💰"></div>
                                <div class="money-label">YenEuro</div>
                                <input type="text" class="money-input" id="money" value="0" onchange="state.money = parseInt(this.value.replace(/\\s+/g, '')) || 0; this.value = formatMoney(state.money); scheduleSave();">
                                <button class="deposit-button" onclick="showDepositModal()">Внести уе</button>
                            </div>
                            
                            <!-- Репутация -->
                            <div class="reputation-section">
                                <div class="reputation-label">РЕПУТАЦИЯ</div>
                                <div class="reputation-controls">
                                    <input type="range" class="reputation-slider" id="reputationSlider" min="-10" max="10" value="0" oninput="state.reputation = parseInt(this.value); document.getElementById('reputationValue').textContent = this.value; updateReputationColor(); scheduleSave();">
                                    <div class="reputation-value" id="reputationValue">0</div>
                                </div>
                            </div>
                            
                            <!-- Профессиональные навыки -->
                            <div class="professional-skills-section">
                                <div class="professional-skills-label">ПРОФЕССИОНАЛЬНЫЕ НАВЫКИ</div>
                                <div class="professional-skills-content">
                                    <div id="professionalSkillsContainer" class="professional-skills-rows">
                                        <!-- Слоты будут заполняться динамически через JS -->
                                    </div>
                                    <button class="pill-button primary-button" onclick="showProfessionalSkillsModal()">+ Добавить навык</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Центральная секция с характеристиками -->
                        <div class="character-stats-section">
                            <!-- Имя персонажа -->
                            <div class="input-group">
                                <label class="input-label">ИМЯ ПЕРСОНАЖА</label>
                                <input type="text" class="input-field" id="characterName" placeholder="Введите имя" onchange="state.characterName = this.value; scheduleSave();">
                            </div>
                            
                            <!-- ЕДИНЫЙ БЛОК: Все 15 характеристик -->
                            <div class="stats-grid-derived">
                                <div class="input-group-compact">
                                    <div class="input-label-compact">Очки обучения</div>
                                    <input type="text" class="input-field-compact" id="experiencePoints" value="0" data-numeric="true" min="0" max="9999" onchange="state.experiencePoints = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="input-group-compact">
                                    <div class="input-label-compact">РОЛЕВЫЕ ОЧКИ</div>
                                    <input type="text" class="input-field-compact" id="roleplayPoints" value="0" data-numeric="true" min="0" max="9999" onchange="state.roleplayPoints = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">ОСОЗНАННОСТЬ</div>
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="awarenessCurrent" value="50" min="0" max="999" onchange="state.awareness.current = parseInt(this.value); scheduleSave();">
                                        <span class="dual-separator-compact">/</span>
                                        <input type="text" class="dual-value-compact" id="awarenessMax" value="50" min="1" max="999" onchange="state.awareness.max = parseInt(this.value); scheduleSave();">
                                    </div>
                                    <div class="stat-formula-compact">Максимальная Осознанность = УМ*10</div>
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Ум">УМ</div>
                                    <input type="text" class="stat-value-compact" id="statINT" value="5" min="1" max="20" onchange="state.stats.INT = parseInt(this.value); updateAwarenessMax(); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Ловкость">ЛВК</div>
                                    <input type="text" class="stat-value-compact" id="statDEX" value="5" min="1" max="20" onchange="state.stats.DEX = parseInt(this.value); updateDerivedStats(); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Телосложение">ТЕЛО</div>
                                    <input type="text" class="stat-value-compact" id="statBODY" value="5" min="1" max="20" onchange="state.stats.BODY = parseInt(this.value); calculateAndUpdateHealth(); updateDerivedStats(); if(typeof updateBikeDescription === 'function') updateBikeDescription(); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Техника">ТЕХ</div>
                                    <input type="text" class="stat-value-compact" id="statTECH" value="5" min="1" max="20" onchange="state.stats.TECH = parseInt(this.value); scheduleSave();">
                                    <div id="techBonus" style="display: none;"></div>
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Характер">ХАР</div>
                                    <input type="text" class="stat-value-compact" id="statCHA" value="5" min="1" max="20" onchange="state.stats.CHA = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Реакция">РЕА</div>
                                    <input type="text" class="stat-value-compact" id="statREA" value="5" min="1" max="20" onchange="state.stats.REA = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">ВОЛЯ</div>
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="statWILL" value="5" min="1" max="20" onchange="state.stats.WILL = parseInt(this.value); calculateAndUpdateHealth(); updateDerivedStats(); scheduleSave();">
                                    </div>
                                </div>
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Врождённая Останавливающая Сила (Броня)">ВОС</div>
                                    <div class="derived-value-compact" id="derivedArmor">2</div>
                                </div>
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Скорость Перемещения">СКОРОСТЬ ПЕРЕМЕЩЕНИЯ</div>
                                    <div class="derived-value-compact" id="derivedSpeed">5</div>
                                    <div id="speedWarning" style="display: none;"></div>
                                </div>
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Скорость Рукопашной Атаки">СКОРОСТЬ РУКОПАШНОЙ АТАКИ</div>
                                    <div class="derived-value-compact" id="derivedAttackSpeed">2</div>
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">УДАЧА</div>                           
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="luckCurrent" value="1" min="0" max="99" onchange="state.luck.current = parseInt(this.value); scheduleSave();">
                                        <span class="dual-separator-compact">/</span>
                                        <input type="text" class="dual-value-compact" id="luckMax" value="1" min="1" max="99" onchange="state.luck.max = parseInt(this.value); scheduleSave();">
                                    </div>
                                </div>
                                <div class="initiative-compact" onclick="rollInitiative()">
                                    <img src="https://static.tildacdn.com/tild3765-3433-4435-b435-636665663530/target_1.png" alt="🎯" class="initiative-icon-compact">
                                    <div class="initiative-text-compact">
                                        <div class="initiative-title-compact">ИНИЦИАТИВА</div>
                                        <div class="initiative-result-compact" id="initiativeResult">Нажмите</div>
                                    </div>
                                    <div class="initiative-modifier-compact">
                                        <div class="initiative-modifier-label">Модификатор</div>
                                        <input type="text" class="initiative-modifier-input" id="initiativeModifier" value="0" placeholder="0" oninput="this.value = this.value.replace(/[^0-9+-]/g, '')" onclick="event.stopPropagation()">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Критические травмы -->
                            <div class="injuries-section" style="margin-top: 1rem;">
                                <div class="injuries-label">КРИТИЧЕСКИЕ ТРАВМЫ</div>
                                <button class="pill-button primary-button" onclick="addCriticalInjury()">+ Добавить травму</button>
                                <div id="injuriesList" class="injuries-list">
                                    <p style="color: var(--muted); font-size: 0.9rem; margin-top: 0.5rem;">Травмы не добавлены</p>
                                </div>
                            </div>

                            <!-- Предыстория -->
                            <div class="backstory-section" style="margin-top: 1rem;">
                                <div class="backstory-header" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div onclick="toggleBackstorySection()" style="cursor: pointer; user-select: none; display: flex; align-items: center;">
                                        <div class="backstory-label">Предыстория персонажа</div>
                                        <div id="backstoryToggleIcon" style="color: var(--muted); font-size: 0.8rem; margin-left: 0.3rem;">▼</div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button onclick="editAllBackstoryCards()" title="Редактировать все элементы" style="background: none; border: none; color: var(--text); padding: 0.25rem; cursor: pointer;">
                                            <img src="https://static.tildacdn.com/tild3539-3065-4366-b139-656331356537/write.png" style="width: 16px; height: 16px;" alt="✏️">
                                        </button>
                                        <button class="pill-button primary-button" onclick="generateBackstory()">&#x1F3B2; Сгенерировать</button>
                                        <button class="pill-button dark-blue-button" onclick="showManualBackstorySelection()"><img src="https://static.tildacdn.com/tild6233-3935-4063-b062-356337336561/pencil.png" alt="✏️" style="width: 16px; height: 16px; margin-right: 0.25rem; vertical-align: middle;"> Выбрать вручную</button>
                                    </div>
                                </div>
                                <!-- Сворачиваемое содержимое предыстории -->
                                <div id="backstoryContentWrapper" style="display: block;">
                                    <!-- Красивое отображение предыстории -->
                                    <div class="backstory-display" id="backstoryDisplay" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; min-height: 120px;">
                                        <div id="backstoryContent" style="display: grid; gap: 0.5rem;">
                                            <!-- Здесь будут карточки предыстории -->
                                            <div id="emptyBackstory" style="color: var(--muted); text-align: center; padding: 1.5rem; font-style: italic; grid-column: 1 / -1;">
                                                Ну и как ты сюда попал?<br>
                                                <span style="font-size: 0.8rem; margin-top: 0.5rem; display: block;">Выберите предысторию или напишите свою</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Скрытый textarea для совместимости -->
                                        <textarea id="backstoryText" style="display: none;" spellcheck="false"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>

            <!-- Навыки - полноширинный блок -->
            <div class="section full-width-section" id="skillsSection">
                <div class="section-header">
                    <h3 class="section-title"><img src="https://static.tildacdn.com/tild6233-3935-4063-b062-356337336561/pencil.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Навыки</h3>
                    <button class="pill-button primary-button" onclick="showAddSkillModal()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Добавить навык</button>
                </div>
                <div class="section-content expanded">
                    <div id="skillsContainer">
                        <p style="color: var(--muted); text-align: center; padding: 2rem;">Навыки не добавлены. Добавьте навыки из библиотеки или создайте свои.</p>
                    </div>
                </div>
            </div>

            <!-- Сетка секций -->
            <div class="sections-grid" id="sectionsGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">


                <!-- Оружие -->
                <div class="section" id="weaponSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6334-3163-4362-b232-366332396435/weapon.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Оружие</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showWeaponShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;"><img src="https://static.tildacdn.com/tild6334-3163-4362-b232-366332396435/weapon.png" alt="🔫" style="width: 16px; height: 16px; margin-right: 0.25rem; vertical-align: middle;"> Купить оружие</button>
                            <button class="pill-button success-button" onclick="showWeaponModulesShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;"><img src="https://static.tildacdn.com/tild3039-3233-4562-b766-373233626433/shop.png" alt="🔧" style="width: 16px; height: 16px; margin-right: 0.25rem; vertical-align: middle;"> Купить модули</button>
                        </div>
                        <div id="weaponsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Оружие не добавлено</p>
                        </div>
                    </div>
                </div>

                <!-- Боеприпасы -->
                <div class="section" id="ammoSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3334-6338-4439-a262-316631336461/bullets.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Боеприпасы</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="pill-button primary-button" onclick="showAmmoShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить боеприпасы</button>
                        </div>
                    </div>
                    <div class="section-content expanded">
                        <div id="ammoContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Боеприпасы не добавлены</p>
                        </div>
                    </div>
                </div>

                <!-- Киберимпланты -->
                <div class="section" id="implantsSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3864-3638-4361-b139-616436373366/woman.png" alt="🦾" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Киберимпланты</h3>
                    </div>
                    <div class="section-content expanded">
                        <div id="implantsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Киберимпланты не установлены</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
                            <button class="pill-button primary-button" onclick="showImplantShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить модуль</button>
                            <button class="pill-button" onclick="showImplantPartsShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить часть импланта</button>
                            <button class="pill-button" onclick="showImplantsManagement()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Управление имплантами</button>
                        </div>
                    </div>
                </div>
                <!-- Броня -->
                <div class="section" id="armorSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3531-3730-4631-a438-353361653361/bulletproof-vest.png" alt="🛡️" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Броня</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showArmorShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить броню</button>
                        </div>
                        <div style="display: grid; gap: 0.5rem;">
                            <!-- Голова -->
                            <div style="display: grid; grid-template-columns: 80px 1fr auto; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Голова:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorHeadOS" value="0" min="0" max="99" onchange="state.armor.head.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('head')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                    <span id="armorHeadType" style="color: var(--text); font-size: 0.8rem; font-weight: 500; min-width: 80px; text-align: center;"></span>
                                </div>
                                <button id="removeArmorHead" onclick="removeEquippedArmor('head')" style="background: transparent; border: none; cursor: pointer; padding: 0; display: none;" title="Снять броню">
                                    <img src="https://static.tildacdn.com/tild6138-3866-4664-b263-333933323732/down.png" alt="↓" style="width: 20px; height: 20px; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                                </button>
                            </div>
                            
                            <!-- Тело -->
                            <div style="display: grid; grid-template-columns: 80px 1fr auto; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Тело:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorBodyOS" value="0" min="0" max="99" onchange="state.armor.body.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('body')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                    <span id="armorBodyType" style="color: var(--text); font-size: 0.8rem; font-weight: 500; min-width: 80px; text-align: center;"></span>
                                </div>
                                <button id="removeArmorBody" onclick="removeEquippedArmor('body')" style="background: transparent; border: none; cursor: pointer; padding: 0; display: none;" title="Снять броню">
                                    <img src="https://static.tildacdn.com/tild6138-3866-4664-b263-333933323732/down.png" alt="↓" style="width: 20px; height: 20px; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                                </button>
                            </div>
                            
                            <!-- Руки -->
                            <div style="display: grid; grid-template-columns: 80px 1fr auto; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Руки:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorArmsOS" value="0" min="0" max="99" onchange="state.armor.arms.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('arms')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                    <span id="armorArmsType" style="color: var(--text); font-size: 0.8rem; font-weight: 500; min-width: 80px; text-align: center;"></span>
                                </div>
                                <button id="removeArmorArms" onclick="removeEquippedArmor('arms')" style="background: transparent; border: none; cursor: pointer; padding: 0; display: none;" title="Снять броню">
                                    <img src="https://static.tildacdn.com/tild6138-3866-4664-b263-333933323732/down.png" alt="↓" style="width: 20px; height: 20px; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                                </button>
                            </div>
                            
                            <!-- Ноги -->
                            <div style="display: grid; grid-template-columns: 80px 1fr auto; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Ноги:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorLegsOS" value="0" min="0" max="99" onchange="state.armor.legs.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('legs')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                    <span id="armorLegsType" style="color: var(--text); font-size: 0.8rem; font-weight: 500; min-width: 80px; text-align: center;"></span>
                                </div>
                                <button id="removeArmorLegs" onclick="removeEquippedArmor('legs')" style="background: transparent; border: none; cursor: pointer; padding: 0; display: none;" title="Снять броню">
                                    <img src="https://static.tildacdn.com/tild6138-3866-4664-b263-333933323732/down.png" alt="↓" style="width: 20px; height: 20px; opacity: 0.7; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                                </button>
                            </div>
                            
                            <!-- Чекбокс для титанической брони -->
                            <div id="titanicArmorCheckbox" style="margin-top: 1rem; padding: 0.75rem; background: rgba(182, 103, 255, 0.1); border: 1px solid var(--accent); border-radius: 8px; display: none;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--accent); font-size: 0.9rem; font-weight: 600;">
                                    <input type="checkbox" id="titanicArmorConnected" onchange="toggleTitanicArmorConnection()" style="width: 16px; height: 16px; accent-color: var(--accent);">
                                    <span>Подключено?</span>
                                </label>
                                <div style="color: var(--text); font-size: 0.8rem; margin-top: 0.5rem; line-height: 1.4;">
                                    При подключении титанической брони штрафы к характеристикам отменяются, но максимальные ПЗ уменьшаются на 5.
                                </div>
                            </div>
                            
                            <!-- Наративное описание брони -->
                            <div style="margin-top: 1rem;">
                                <label class="input-label" style="display: block; margin-bottom: 0.5rem;">ОПИСАНИЕ БРОНИ</label>
                                <textarea class="input-field" id="armorDescription" placeholder="Опишите, что надето на персонаже..." onchange="state.armor.description = this.value; scheduleSave();" style="min-height: 80px; resize: vertical;"></textarea>
                            </div>
                            
                            <!-- Инвентарь купленной брони -->
                            <div style="margin-top: 1.5rem;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                                    <label class="input-label" style="margin: 0;">ИНВЕНТАРЬ БРОНИ</label>
                                    <span style="color: var(--muted); font-size: 0.8rem;" id="armorInventoryCount">(0)</span>
                                </div>
                                <div id="armorInventoryContainer" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <p style="color: var(--muted); text-align: center; padding: 1rem; font-size: 0.85rem;">Купленная броня появится здесь</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Дека -->
                <div class="section" id="deckSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3633-6632-4463-a435-353036636235/live-streaming.png" alt="💾" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Дека</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; padding: 0 1rem;">
                        <button class="pill-button primary-button" onclick="showProgramShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить программу</button>
                        <button class="pill-button success-button" onclick="showDeckShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">💻 Магазин Дек</button>
                        <button class="pill-button warning-button" onclick="showDeckGearShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">🔧 Снаряжение</button>
                        <button class="pill-button" onclick="showDeckCollection()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">📚 Мои Деки</button>
                    </div>
                    <div class="section-content expanded">
                        <!-- Щепки памяти - сворачиваемая секция -->
                        <div>
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem; background: rgba(182, 103, 255, 0.1); border: 1px solid var(--accent); border-radius: 8px; cursor: pointer;" onclick="toggleDeckSection('chips')">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span id="deckChipsToggle" style="color: var(--accent); font-size: 0.8rem;">▼</span>
                                    <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Щепки памяти</span>
                                    <span id="deckChipsCount" style="color: var(--muted); font-size: 0.8rem;">(0)</span>
                                </div>
                                <button class="pill-button" onclick="event.stopPropagation(); addMemoryChip()" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">Добавить щепку</button>
                            </div>
                            <div id="deckChipsContainer" style="margin-top: 0.5rem;">
                                <p style="color: var(--muted); text-align: center; padding: 1rem; font-size: 0.8rem;">Щепки памяти не добавлены</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Снаряжение -->
                <div class="section" id="gearSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3363-6531-4132-a138-663132646531/remote-control.png" alt="🎒" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Снаряжение</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showGearShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить снаряжение</button>
                            <button class="pill-button success-button" onclick="pickupGear()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Подобрать с пола</button>
                        </div>
                        <div style="background: rgba(91, 155, 255, 0.1); border: 1px solid #5b9bff; border-radius: 8px; padding: 0.75rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; white-space: nowrap;">
                                <span style="color: var(--text);">Нагрузка:</span>
                                <span style="color: var(--accent); font-weight: 600;"><span id="currentLoad">25</span> / <span id="maxLoad">25</span></span>
                            </div>
                            <div style="display: flex; justify-content: center; margin-bottom: 0.5rem;">
                                <button class="pill-button muted-button" onclick="resetLoad()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Сбросить нагрузку</button>
                            </div>
                            <div id="loadWarning" style="color: var(--danger); font-size: 0.9rem; margin-top: 0.5rem; display: none;"></div>
                        </div>
                        <div id="gearContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Снаряжение не добавлено</p>
                        </div>
                    </div>
                </div>

                <!-- Препараты -->
                <div class="section" id="drugsSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3532-3565-4033-a136-653464353038/drugs.png" alt="💊" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Препараты</h3>
                        <button class="pill-button primary-button" onclick="showDrugsShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить препараты</button>
                    </div>
                    <div class="section-content expanded">
                        <div id="drugsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Препараты не добавлены</p>
                        </div>
                    </div>
                </div>


                <!-- Скупщик -->
                <div class="section" id="fenceSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6630-3835-4431-b030-326266363466/seafood.png" alt="🦞" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Скупщик</h3>
                        <button class="pill-button success-button" onclick="showFenceShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Продать вещи</button>
                    </div>
                    <div class="section-content expanded">
                        <div style="padding: 1rem; background: rgba(125, 244, 198, 0.05); border: 1px solid rgba(125, 244, 198, 0.2); border-radius: 8px; margin-bottom: 1rem;">
                            <p style="color: var(--text); font-size: 0.85rem; line-height: 1.5; margin: 0;">
                                <strong style="color: var(--success);">Скупщик</strong> покупает почти всё по сниженной цене.<br>
                                <span style="color: var(--muted); font-size: 0.8rem;"><img src="https://static.tildacdn.com/tild3235-6133-4838-b966-303966353032/stop.png" alt="❌" style="width: 16px; height: 16px; vertical-align: middle;"> Не покупает: броню, транспорт и медикаменты</span>
                            </p>
                        </div>
                        <div id="fenceHistory" style="max-height: 300px; overflow-y: auto;">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Ещё ничего не продано</p>
                        </div>
                    </div>
                </div>

                <!-- Недвижимость -->
                <div class="section" id="realEstateSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3336-3839-4738-a462-303336633561/lease.png" alt="🏢" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Недвижимость</h3>
                    </div>
                    <div class="section-content expanded">
                        <!-- Жилье -->
                        <div class="property-subsection">
                            <div class="section-subtitle">Жилье</div>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                                <button class="pill-button primary-button" onclick="showHousingShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить жилье</button>
                            </div>
                            <div id="housingContainer">
                                <p style="color: var(--muted); text-align: center; padding: 1rem;">Жилье не добавлено</p>
                            </div>
                        </div>

                        <!-- Коммерческая недвижимость -->
                        <div class="property-subsection">
                            <div class="section-subtitle">Коммерческая недвижимость</div>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                                <button class="pill-button success-button" onclick="showCommercialPropertyShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить коммерческую недвижимость</button>
                            </div>
                            <div id="commercialPropertyContainer">
                                <p style="color: var(--muted); text-align: center; padding: 1rem;">Коммерческая недвижимость не добавлена</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Транспорт -->
                <div class="section" id="transportSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3130-6637-4132-a334-663633373435/car.png" alt="🚗" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Транспорт</h3>
                    </div>
                    <div class="section-content expanded">
                        <div id="transportContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Транспорт не добавлен</p>
                        </div>
                    </div>
                </div>
                
                <!-- Модули транспорта -->
                <div class="section" id="vehicleModulesSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6535-3132-4233-b731-356365363437/wrench.png" alt="🔧" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Модули транспорта</h3>
                    </div>
                    <div class="section-content expanded">
                        <div id="vehicleModulesContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Модули не добавлены</p>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <!-- Плавающая кнопка счетчиков -->
    <div class="counter-button" id="counterButton" onclick="showCountersModal()" style="position: fixed; bottom: 340px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild3437-6537-4161-b166-323464626265/counter.png" alt="🔢" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающая кнопка расчета расстояния -->
    <div class="distance-button" id="distanceButton" onclick="showDistanceModal()" style="position: fixed; bottom: 260px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild6165-6336-4430-b838-623834316461/height.png" alt="📏" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающая кнопка бросалки кубов -->
    <div class="dice-button" id="diceButton" onclick="showUniversalDiceModal()" style="position: fixed; bottom: 180px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild6461-3139-4934-a463-333563633064/dice.png" alt="&#x1F3B2;" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающая кнопка заметок -->
    <div class="notes-button" id="notesButton" onclick="showNotesModal()" style="position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <span style="font-size: 1.5rem; color: var(--bg); font-weight: bold;">&#x1F4DD;</span>
    </div>

    <!-- Плавающая кнопка логов -->
    <div class="log-button" id="logButton" onclick="showFloatingLog()" style="position: fixed; bottom: 100px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild3432-3537-4564-a261-623265663130/log-data.png" alt="📡" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающий блок логов -->
    <div class="floating-log-window" id="floatingLogWindow" style="position: fixed; top: 100px; right: 20px; width: 400px; height: 500px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 12px; box-shadow: 0 8px 32px rgba(19, 31, 42, 0.8); z-index: 999; border: 2px solid #2a3d4f; display: flex; flex-direction: column; resize: both; overflow: hidden; min-width: 300px; min-height: 200px; max-width: 90vw; max-height: 90vh;">
        <!-- Заголовок (для перетаскивания) -->
        <div class="floating-log-header" id="floatingLogHeader" style="background: linear-gradient(135deg, #1a2633, #213040); padding: 0.75rem 1rem; border-bottom: 1px solid #2a3d4f; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
            <span style="color: #00ffff; font-weight: 600; font-size: 0.9rem;">📡 ЛОГ ТВОЕЙ ЖИЗНИ</span>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="clearRollLog()" style="background: transparent; border: none; color: #ff5b87; cursor: pointer; font-size: 0.8rem; padding: 0.2rem 0.5rem; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,91,135,0.2)'" onmouseout="this.style.background='transparent'">Очистить</button>
                <button onclick="hideFloatingLog()" style="background: transparent; border: none; color: #00ffff; cursor: pointer; font-size: 1.2rem; line-height: 1; padding: 0;" title="Скрыть">×</button>
            </div>
        </div>
        <!-- Контент -->
        <div id="floatingLogContent" style="flex: 1; overflow-y: auto; padding: 0.5rem; font-size: 0.85rem; line-height: 1.4;">
            <p style="color: #5a7a8a; text-align: center; padding: 2rem;">Лог бросков пуст</p>
        </div>
    </div>

    <!-- Свернутый блок логов (трей) -->
    <div class="minimized-log" id="minimizedLog" onclick="toggleFloatingLog()" style="display: none; position: fixed; bottom: 180px; left: 20px; padding: 0.5rem 1rem; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 20px; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; border: 2px solid #2a3d4f; transition: all 0.3s ease;">
        <span style="color: #00ffff; font-weight: 600; font-size: 0.85rem;">📡 ЛОГ</span>
    </div>

    <!-- Модальное окно расчета расстояния -->
    <div class="modal-overlay" id="distanceModal" style="display: none;">
        <div class="modal" style="width: 800px; max-width: 90vw;">
            <div class="modal-header">
                <h3><img src="https://static.tildacdn.com/tild6165-6336-4430-b838-623834316461/height.png" alt="📏" style="width: 24px; height: 24px; margin-right: 0.5rem; vertical-align: middle;"> КАЛЬКУЛЯТОР РАССТОЯНИЯ ДО ЦЕЛИ</h3>
                <button class="icon-button" onclick="hideDistanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: start;">
                    <!-- Форма ввода -->
                    <div>
                        <div class="input-group">
                            <label class="input-label">ВАША ВЫСОТА (пространства)</label>
                            <input type="number" class="input-field" id="shooterHeight" placeholder="0" min="0" max="999">
                            <div style="font-size: 0.75rem; color: var(--muted); margin-top: 0.15rem;">
                                Высота стрелка над землей
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">УДАЛЕНИЕ ЦЕЛИ (пространства)</label>
                            <input type="number" class="input-field" id="targetDistance" placeholder="0" min="0" max="999">
                            <div style="font-size: 0.75rem; color: var(--muted); margin-top: 0.15rem;">
                                Горизонтальное расстояние до цели
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 1rem;">
                            <button class="pill-button primary-button" onclick="calculateDistance()" style="font-size: 0.9rem; padding: 0.6rem 1.5rem;">
                                <img src="https://static.tildacdn.com/tild3131-3664-4938-a532-363264356661/target_2.png" alt="🎯" style="width: 20px; height: 20px; margin-right: 0.5rem; vertical-align: middle;"> РАССЧИТАТЬ РАССТОЯНИЕ
                            </button>
                        </div>
                        
                        <!-- Результат -->
                        <div id="distanceResult" style="display: none; margin-top: 1rem;">
                            <div style="background: linear-gradient(135deg, rgba(182, 103, 255, 0.1), rgba(58, 44, 247, 0.05)); border: 1px solid var(--accent); border-radius: 12px; padding: 1rem; text-align: center; margin-bottom: 1rem;">
                                <div style="color: var(--accent); font-size: 0.8rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.25rem;">
                                    РЕЗУЛЬТАТ
                                </div>
                                <div id="totalDistance" style="color: var(--text); font-size: 1.8rem; font-weight: 700; margin-bottom: 0.25rem;">
                                    0
                                </div>
                                <div style="color: var(--muted); font-size: 0.8rem;">
                                    пространств до цели
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <div style="background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; text-align: center;">
                                    <div style="color: var(--success); font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.15rem;">
                                        Горизонтально
                                    </div>
                                    <div id="horizontalDistance" style="color: var(--text); font-size: 1.1rem; font-weight: 600;">
                                        0
                                    </div>
                                </div>
                                <div style="background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; text-align: center;">
                                    <div style="color: var(--accent); font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.15rem;">
                                        По высоте
                                    </div>
                                    <div id="verticalDistance" style="color: var(--text); font-size: 1.1rem; font-weight: 600;">
                                        0
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Визуализация -->
                    <div>
                        
                        <!-- Canvas для визуализации -->
                        <div id="distanceVisualization" style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem; min-height: 160px; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align: center; color: var(--muted);">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">🎯</div>
                                <div>Введите данные для расчета</div>
                            </div>
                        </div>
                        
                        <!-- Контейнер для информации о сложности попадания -->
                        <div id="hitDifficultyInfo" style="display: none;">
                            <!-- Информация будет добавлена динамически -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <!-- ПОДКЛЮЧЕНИЕ JAVASCRIPT ФАЙЛОВ ПРОЕКТА                                  -->
    <!-- ВАЖНО: Порядок подключения имеет значение!                             -->
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    
    <!-- DATA.JS → Все базовые данные: навыки, оружие, импланты, броня, магазины -->
    <script src="data.js?v=20241220"></script>
    
    <!-- PROFESSIONAL-SKILLS.JS → Профессиональные навыки: выбор, добавление, управление -->
    <script src="professional-skills.js?v=20250103"></script>
    
    <!-- UTILS.JS → Вспомогательные функции: сохранение/загрузка, форматирование, модалки -->
    <script src="utils.js?v=20241220"></script>
    
    <!-- ARMOR.JS → Система брони: покупка, экипировка, расчёт штрафов, ВОС -->
    <script src="armor.js?v=20241220"></script>
    
    <!-- VEHICLES.JS → Транспорт: покупка, модули, багажники, характеристики -->
    <script src="transport.js?v=20250103&modules-redesign=1"></script>
    
    <!-- DRUGS.JS → Препараты: покупка, использование, эффекты -->
    <script src="drugs.js?v=20241220"></script>
    
    <!-- SHOPS.JS → Магазины: жилье, коммерческая недвижимость, универсальная покупка -->
    <script src="shops.js?v=20250103&stubs-removed=1"></script>
    
    <!-- DECK.JS → Дека: программы, щепки памяти, магазин дек, снаряжение -->
    <script src="deck.js?v=20250103&quotes-fixed=1"></script>
    
    <!-- WEAPONS.JS → Оружие: покупка, модули, боеприпасы, стрельба -->
    <script src="weapons.js?v=20250103&logs-removed=1"></script>
    
    <!-- GEAR.JS → Снаряжение: покупка, нагрузка, подбор с пола, управление -->
    <script src="gear.js?v=20250103&logs-removed=1"></script>
    
    <!-- SCRIPTS.JS → Основной функционал: характеристики, здоровье, навыки, инициализация -->
    <script src="scripts.js?v=20241220"></script>
    
    <!-- FENCE.JS → Скупщик: продажа вещей, история продаж, расчёт цен -->
    <script src="fence.js?v=20241220"></script>
    
    <!-- BARGAIN-PURCHASE.JS → Система торга: переговоры при покупке, моды цен -->
    <script src="bargain-purchase.js?v=20241220"></script>
    
    <script>
        // Инициализация приложения после загрузки DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('%c EZY: Cyber Character Sheet ', 'background: #b667ff; color: #0a0712; font-weight: bold; padding: 4px;');
            
            // Проверяем загрузку всех компонентов
            if (typeof STANDARD_SKILLS !== 'undefined') {
                console.log('✓ Data.js загружен');
            } else {
                console.error('✗ Data.js НЕ загружен! Проверьте data.js');
            }
            
            if (typeof saveState === 'function') {
                console.log('✓ Utils.js загружен');
            } else {
                console.error('✗ Utils.js НЕ загружен! Проверьте utils.js');
            }
            
            if (typeof renderSkills === 'function') {
                console.log('✓ Scripts.js загружен');
            } else {
                console.error('✗ Scripts.js НЕ загружен! Проверьте scripts.js');
            }
            
            // Запускаем приложение
            try {
                if (typeof loadState === 'function') {
                    loadState();
                }
                
                if (typeof detectTouchDevice === 'function') {
                    detectTouchDevice();
                }
                
                if (typeof initializeNumericInputs === 'function') {
                    initializeNumericInputs();
                }
                
                // Запускаем загрузочный экран
                if (typeof startLoadingAnimation === 'function') {
                    startLoadingAnimation();
                }
                
                console.log('✓ Приложение инициализировано успешно!');
            } catch (error) {
                console.error('✗ Ошибка инициализации:', error);
            }
        });
    </script>
</body>
</html>
