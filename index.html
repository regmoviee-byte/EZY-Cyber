<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZY: Cyber — Идеальный чарник v2.1</title>
    <meta name="description" content="Интерактивный лист персонажа для настольной ролевой игры EZY: Cyber">
    
    <!-- Иконка сайта -->
    <link rel="icon" type="image/png" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    <link rel="shortcut icon" type="image/png" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    <link rel="apple-touch-icon" href="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG">
    
    <!-- Подключение CSS стилей -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Заглушка для мобильных устройств -->
    <div class="mobile-warning" id="mobileWarning" style="display: none;">
        <div class="mobile-warning-content">
            <div class="mobile-warning-icon">&#x1F4F1;</div>
            <h2 class="mobile-warning-title">Экран слишком мал</h2>
            <p class="mobile-warning-text">
                Данное приложение предназначено для использования на устройствах с большим экраном.
                <br><br>
                Пожалуйста, откройте страницу на компьютере, ноутбуке или планшете с экраном шириной от 1024px.
            </p>
            <div class="mobile-warning-specs">
                <div>Ваш экран: <span id="screenWidth">0</span>px</div>
                <div>Минимум: 1024px</div>
            </div>
        </div>
    </div>

    <!-- Загрузочный экран -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">EZY: CYBER // HUMAN_DESIGN [БАРЫГА И ДЕКА v0.93.18764]</div>
        <div class="loading-log" id="loadingLog">
            <div class="loading-log-item" id="logItem1"></div>
            <div class="loading-log-item" id="logItem2"></div>
            <div class="loading-log-item" id="logItem3"></div>
            <div class="loading-log-item" id="logItem4"></div>
            <div class="loading-log-item" id="logItem5"></div>
            <div class="loading-log-item" id="logItem6"></div>
        </div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="progressBar"></div>
            <div class="loading-progress-text" id="progressText">0%</div>
        </div>
    </div>
    <!-- Основной интерфейс -->
    <div class="main-interface" id="mainInterface">
        <!-- Заголовок -->
        <header class="header">
            <div class="header-title"><img src="https://static.tildacdn.com/tild3037-6565-4133-b430-363832636466/IMG_8068.PNG" alt="🧬" style="width: 50px; height: 50px; margin-right: 0.5rem; vertical-align: middle;"> EZY: Cyber — Лист персонажа</div>
            <div class="header-controls">
                <button class="pill-button primary-button" onclick="exportData()">💾 Сохранить персонажа</button>
                <button class="pill-button muted-button" onclick="importData()">&#x27F2; Импорт JSON</button>
                <button class="pill-button danger-button" onclick="clearAllData()">Очистить данные</button>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="main-content">

            <!-- Общая информация - полноширинный блок -->
            <div class="section full-width-section" id="generalInfoSection">
                <div class="section-header">
                    <h3 class="section-title"><img src="https://static.tildacdn.com/tild3634-6236-4031-b939-313937393365/resume.png" alt="🧠" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Общая информация</h3>
                </div>
                <div class="section-content expanded">
                    <!-- Главная сетка: Аватар слева, информация в центре -->
                    <div class="character-sheet-layout" style="display: grid; grid-template-columns: auto 1fr; gap: 2rem; margin-bottom: 1.5rem;">
                        <!-- Аватар, кнопки, здоровье и деньги -->
                        <div class="avatar-section">
                            <div id="avatarDisplay" class="avatar-placeholder" style="width: 100%; height: 400px;">
                                &#x1F916;
                            </div>
                            <div class="avatar-controls">
                                <label class="pill-button muted-button avatar-button">
                                    &#x1F4F7; Загрузить фото
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;" />
                                </label>
                                <button class="pill-button muted-button avatar-button" id="removeAvatarButton"><img src="https://static.tildacdn.com/tild6166-3331-4338-b038-623539346365/x-button.png" alt="🗑️" style="width: 16px; height: 16px;"> Удалить</button>
                            </div>
                            
                            <!-- Пункты здоровья -->
                            <div class="health-box" style="margin-top: 1rem; width: 100%; display: flex; flex-direction: column; align-items: center;">
                                <div class="health-icon"><img src="https://static.tildacdn.com/tild6361-6133-4534-b338-616664333865/heart.png" alt="❤️" style="width: 24px; height: 24px;"></div>
                                <div class="health-label" style="font-size: 0.7rem; text-align: center;">ПУНКТЫ ЗДОРОВЬЯ</div>
                                <div class="health-values" style="display: flex; align-items: center; gap: 0.5rem; justify-content: center;">
                                    <input type="text" class="health-input" id="healthCurrent" value="25" min="0" onchange="state.health.current = parseInt(this.value); scheduleSave();" style="width: 60px; text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-size: 1rem; font-weight: 600;">
                                    <span class="health-separator" style="color: var(--text); font-size: 1rem; font-weight: 600;">/</span>
                                    <input type="text" class="health-input" id="healthMax" value="38" readonly style="width: 60px; text-align: center; padding: 0.5rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-size: 1rem; font-weight: 600;">
                                </div>
                            </div>
                            
                            <!-- YenEuro -->
                            <div class="money-box" style="margin-top: 0.75rem; width: 100%;">
                                <div class="money-icon"><img src="https://static.tildacdn.com/tild3939-6162-4633-a238-623334613265/photo.png" alt="💰" style="width: 16px; height: 16px; vertical-align: middle;"></div>
                                <div class="money-label" style="font-size: 0.7rem;">YenEuro</div>
                                <input type="text" class="money-input" id="money" value="0" onchange="state.money = parseInt(this.value.replace(/\\s+/g, '')) || 0; this.value = formatMoney(state.money); scheduleSave();" style="width: 100%; font-size: 1rem; padding: 0.5rem; text-align: center;">
                                <button class="deposit-button" onclick="showDepositModal()" style="background: transparent; border: none; color: var(--accent); text-decoration: underline; font-size: 0.7rem; cursor: pointer; margin-top: 0.25rem; padding: 0;">Внести уе</button>
                            </div>
                            
                            <!-- Репутация -->
                            <div class="reputation-section" style="margin-top: 0.75rem; width: 100%;">
                                <div class="reputation-label" style="font-size: 0.7rem; color: var(--accent); font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; text-align: center;">РЕПУТАЦИЯ</div>
                                <div class="reputation-controls" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                    <input type="range" class="reputation-slider" id="reputationSlider" min="-10" max="10" value="0" oninput="state.reputation = parseInt(this.value); document.getElementById('reputationValue').textContent = this.value; updateReputationColor(); scheduleSave();" style="width: 100%;">
                                    <div class="reputation-value" id="reputationValue" style="text-align: center; font-weight: 600; font-size: 1.2rem; color: white;">0</div>
                                </div>
                            </div>
                            
                            <!-- Профессиональные навыки -->
                            <div class="professional-skills-section" style="margin-top: 0.75rem; width: 100%;">
                                <div class="professional-skills-label" style="font-size: 0.7rem; color: var(--accent); font-weight: 600; margin-bottom: 0.5rem; text-transform: uppercase; text-align: center;">ПРОФЕССИОНАЛЬНЫЕ НАВЫКИ</div>
                                <div class="professional-skills-content" style="background: rgba(0,0,0,0.2); border: 1px solid rgba(182, 103, 255, 0.2); border-radius: 8px; padding: 0.5rem;">
                                    <div class="professional-skills-header" style="display: grid; grid-template-columns: 1fr 60px; gap: 0.5rem; margin-bottom: 0.5rem; font-size: 0.6rem; color: var(--muted); text-transform: uppercase; font-weight: 600;">
                                        <div>НАЗВАНИЕ</div>
                                        <div style="text-align: center;">УРОВЕНЬ</div>
                                    </div>
                                    <div class="professional-skills-rows">
                                        <div class="professional-skill-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.25rem; align-items: flex-start;">
                                            <textarea class="professional-skill-name" id="professionalSkillName0" placeholder="Название навыка" onchange="updateProfessionalSkill(0, this.value, document.getElementById('professionalSkillLevel0').value);" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 3px; padding: 0.25rem; color: var(--text); font-size: 0.7rem; height: 1.5rem; resize: none; overflow: hidden; font-family: inherit; flex: 1;"></textarea>
                                            <div class="integrated-numeric-input" style="width: 60px;">
                                                <button class="integrated-numeric-btn" onclick="decreaseProfessionalSkillLevel(0)">-</button>
                                                <input type="text" class="integrated-numeric-field" id="professionalSkillLevel0" value="0" min="0" max="15" onchange="updateProfessionalSkill(0, document.getElementById('professionalSkillName0').value, this.value);" style="font-size: 0.7rem;">
                                                <button class="integrated-numeric-btn" onclick="increaseProfessionalSkillLevel(0)">+</button>
                                            </div>
                                        </div>
                                        <div class="professional-skill-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.25rem; align-items: flex-start;">
                                            <textarea class="professional-skill-name" id="professionalSkillName1" placeholder="Название навыка" onchange="updateProfessionalSkill(1, this.value, document.getElementById('professionalSkillLevel1').value);" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 3px; padding: 0.25rem; color: var(--text); font-size: 0.7rem; height: 1.5rem; resize: none; overflow: hidden; font-family: inherit; flex: 1;"></textarea>
                                            <div class="integrated-numeric-input" style="width: 60px;">
                                                <button class="integrated-numeric-btn" onclick="decreaseProfessionalSkillLevel(1)">-</button>
                                                <input type="text" class="integrated-numeric-field" id="professionalSkillLevel1" value="0" min="0" max="15" onchange="updateProfessionalSkill(1, document.getElementById('professionalSkillName1').value, this.value);" style="font-size: 0.7rem;">
                                                <button class="integrated-numeric-btn" onclick="increaseProfessionalSkillLevel(1)">+</button>
                                            </div>
                                        </div>
                                        <div class="professional-skill-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.25rem; align-items: flex-start;">
                                            <textarea class="professional-skill-name" id="professionalSkillName2" placeholder="Название навыка" onchange="updateProfessionalSkill(2, this.value, document.getElementById('professionalSkillLevel2').value);" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 3px; padding: 0.25rem; color: var(--text); font-size: 0.7rem; height: 1.5rem; resize: none; overflow: hidden; font-family: inherit; flex: 1;"></textarea>
                                            <div class="integrated-numeric-input" style="width: 60px;">
                                                <button class="integrated-numeric-btn" onclick="decreaseProfessionalSkillLevel(2)">-</button>
                                                <input type="text" class="integrated-numeric-field" id="professionalSkillLevel2" value="0" min="0" max="15" onchange="updateProfessionalSkill(2, document.getElementById('professionalSkillName2').value, this.value);" style="font-size: 0.7rem;">
                                                <button class="integrated-numeric-btn" onclick="increaseProfessionalSkillLevel(2)">+</button>
                                            </div>
                                        </div>
                                        <div class="professional-skill-row" style="display: flex; gap: 0.5rem; align-items: flex-start;">
                                            <textarea class="professional-skill-name" id="professionalSkillName3" placeholder="Название навыка" onchange="updateProfessionalSkill(3, this.value, document.getElementById('professionalSkillLevel3').value);" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 3px; padding: 0.25rem; color: var(--text); font-size: 0.7rem; height: 1.5rem; resize: none; overflow: hidden; font-family: inherit; flex: 1;"></textarea>
                                            <div class="integrated-numeric-input" style="width: 60px;">
                                                <button class="integrated-numeric-btn" onclick="decreaseProfessionalSkillLevel(3)">-</button>
                                                <input type="text" class="integrated-numeric-field" id="professionalSkillLevel3" value="0" min="0" max="15" onchange="updateProfessionalSkill(3, document.getElementById('professionalSkillName3').value, this.value);" style="font-size: 0.7rem;">
                                                <button class="integrated-numeric-btn" onclick="increaseProfessionalSkillLevel(3)">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Центральная секция с характеристиками -->
                        <div class="character-stats-section" style="display: flex; flex-direction: column; gap: 1rem;">
                            <!-- Имя персонажа -->
                            <div class="input-group">
                                <label class="input-label">ИМЯ ПЕРСОНАЖА</label>
                                <input type="text" class="input-field" id="characterName" placeholder="Введите имя" onchange="state.characterName = this.value; scheduleSave();">
                            </div>
                            
                            <!-- Первая строка: ОЧКИ ОПЫТА, РОЛЕВЫЕ ОЧКИ, ОСОЗНАННОСТЬ, УМ, ЛВК -->
                            <div class="stats-grid-derived">
                                <div class="input-group-compact">
                                    <div class="input-label-compact">ОЧКИ ОПЫТА</div>
                                    <input type="text" class="input-field-compact" id="experiencePoints" value="0" data-numeric="true" min="0" max="9999" onchange="state.experiencePoints = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="input-group-compact">
                                    <div class="input-label-compact">РОЛЕВЫЕ ОЧКИ</div>
                                    <input type="text" class="input-field-compact" id="roleplayPoints" value="0" data-numeric="true" min="0" max="9999" onchange="state.roleplayPoints = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">ОСОЗНАННОСТЬ</div>
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="awarenessCurrent" value="50" min="0" max="999" onchange="state.awareness.current = parseInt(this.value); scheduleSave();">
                                        <span class="dual-separator-compact">/</span>
                                        <input type="text" class="dual-value-compact" id="awarenessMax" value="50" min="1" max="999" onchange="state.awareness.max = parseInt(this.value); scheduleSave();">
                                    </div>
                                    <div class="stat-formula-compact">Максимальная Осознанность = УМ*10</div>
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Ум">УМ</div>
                                    <input type="text" class="stat-value-compact" id="statINT" value="5" min="1" max="20" onchange="state.stats.INT = parseInt(this.value); updateAwarenessMax(); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Ловкость">ЛВК</div>
                                    <input type="text" class="stat-value-compact" id="statDEX" value="5" min="1" max="20" onchange="state.stats.DEX = parseInt(this.value); updateDerivedStats(); scheduleSave();">
                                </div>
                            </div>
                            
                            <!-- Вторая строка: ТЕЛО, ТЕХ, ХАР, РЕА, ВОЛЯ -->
                            <div class="stats-grid-derived">
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Телосложение">ТЕЛО</div>
                                    <input type="text" class="stat-value-compact" id="statBODY" value="5" min="1" max="20" onchange="state.stats.BODY = parseInt(this.value); calculateAndUpdateHealth(); updateDerivedStats(); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Техника">ТЕХ</div>
                                    <input type="text" class="stat-value-compact" id="statTECH" value="5" min="1" max="20" onchange="state.stats.TECH = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Харизма">ХАР</div>
                                    <input type="text" class="stat-value-compact" id="statCHA" value="5" min="1" max="20" onchange="state.stats.CHA = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-box-compact">
                                    <div class="stat-label-compact" title="Реакция">РЕА</div>
                                    <input type="text" class="stat-value-compact" id="statREA" value="5" min="1" max="20" onchange="state.stats.REA = parseInt(this.value); scheduleSave();">
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">ВОЛЯ</div>
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="statWILL" value="5" min="1" max="20" onchange="state.stats.WILL = parseInt(this.value); updateDerivedStats(); scheduleSave();">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Третья строка: ВОС, СКОРОСТЬ ПЕРЕМЕЩЕНИЯ, СКОРОСТЬ РУКОПАШНОЙ АТАКИ, УДАЧА -->
                            <div class="stats-grid-derived">
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Врождённая Останавливающая Сила (Броня)">ВОС</div>
                                    <div class="derived-value-compact" id="derivedArmor">2</div>
                                </div>
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Скорость Перемещения">СКОРОСТЬ ПЕРЕМЕЩЕНИЯ</div>
                                    <div class="derived-value-compact" id="derivedSpeed">5</div>
                                    <div id="speedWarning" style="display: none;"></div>
                                </div>
                                <div class="derived-stat-compact">
                                    <div class="derived-label-compact" title="Скорость Рукопашной Атаки">СКОРОСТЬ РУКОПАШНОЙ АТАКИ</div>
                                    <div class="derived-value-compact" id="derivedAttackSpeed">2</div>
                                </div>
                                <div class="stat-dual-compact">
                                    <div class="stat-label-compact">УДАЧА</div>                           
                                    <div class="dual-values-compact">
                                        <input type="text" class="dual-value-compact" id="luckCurrent" value="1" min="0" max="99" onchange="state.luck.current = parseInt(this.value); scheduleSave();">
                                        <span class="dual-separator-compact">/</span>
                                        <input type="text" class="dual-value-compact" id="luckMax" value="1" min="1" max="99" onchange="state.luck.max = parseInt(this.value); scheduleSave();">
                                    </div>
                                </div>
                                <div class="initiative-compact" onclick="rollInitiative()">
                                    <img src="https://static.tildacdn.com/tild3765-3433-4435-b435-636665663530/target_1.png" alt="🎯" class="initiative-icon-compact">
                                    <div class="initiative-text-compact">
                                        <div class="initiative-title-compact">ИНИЦИАТИВА</div>
                                        <div class="initiative-result-compact" id="initiativeResult">Нажмите</div>
                                    </div>
                                    <div class="initiative-modifier-compact">
                                        <div class="initiative-modifier-label">Модификатор</div>
                                        <input type="text" class="initiative-modifier-input" id="initiativeModifier" value="0" placeholder="0" oninput="this.value = this.value.replace(/[^0-9+-]/g, '')" onclick="event.stopPropagation()">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Критические травмы -->
                            <div class="injuries-section" style="margin-top: 1rem;">
                                <div class="injuries-label">КРИТИЧЕСКИЕ ТРАВМЫ</div>
                                <button class="pill-button primary-button" onclick="addCriticalInjury()">+ Добавить травму</button>
                                <div id="injuriesList" class="injuries-list">
                                    <p style="color: var(--muted); font-size: 0.9rem; margin-top: 0.5rem;">Травмы не добавлены</p>
                                </div>
                            </div>

                            <!-- Предыстория -->
                            <div class="backstory-section" style="margin-top: 1rem;">
                                <div class="backstory-header">
                                    <div class="backstory-icon">&#x1F4C4;</div>
                                    <div class="backstory-label">Предыстория персонажа</div>
                                    <button class="pill-button primary-button" onclick="generateBackstory()">&#x1F3B2; Сгенерировать</button>
                                </div>
                                <textarea class="backstory-textarea" id="backstoryText" placeholder="Ну и как ты сюда попал?" onchange="state.backstory = this.value; scheduleSave();" style="height: 200px;"></textarea>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>

            <!-- Навыки - полноширинный блок -->
            <div class="section full-width-section" id="skillsSection">
                <div class="section-header">
                    <h3 class="section-title"><img src="https://static.tildacdn.com/tild6233-3935-4063-b062-356337336561/pencil.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Навыки</h3>
                    <button class="pill-button primary-button" onclick="showAddSkillModal()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Добавить навык</button>
                </div>
                <div class="section-content expanded">
                    <div id="skillsContainer">
                        <p style="color: var(--muted); text-align: center; padding: 2rem;">Навыки не добавлены. Добавьте навыки из библиотеки или создайте свои.</p>
                    </div>
                </div>
            </div>

            <!-- Сетка секций -->
            <div class="sections-grid" id="sectionsGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">


                <!-- Оружие -->
                <div class="section" id="weaponSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6334-3163-4362-b232-366332396435/weapon.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Оружие</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showWeaponShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;"><img src="https://static.tildacdn.com/tild6334-3163-4362-b232-366332396435/weapon.png" alt="🔫" style="width: 16px; height: 16px; margin-right: 0.25rem; vertical-align: middle;"> Купить оружие</button>
                            <button class="pill-button success-button" onclick="showWeaponModulesShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;"><img src="https://static.tildacdn.com/tild3039-3233-4562-b766-373233626433/shop.png" alt="🔧" style="width: 16px; height: 16px; margin-right: 0.25rem; vertical-align: middle;"> Купить модули</button>
                        </div>
                        <div id="weaponsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Оружие не добавлено</p>
                        </div>
                    </div>
                </div>

                <!-- Боеприпасы -->
                <div class="section" id="ammoSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3334-6338-4439-a262-316631336461/bullets.png" alt="🔫" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Боеприпасы</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="pill-button primary-button" onclick="showAmmoShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить боеприпасы</button>
                        </div>
                    </div>
                    <div class="section-content expanded">
                        <div id="ammoContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Боеприпасы не добавлены</p>
                        </div>
                    </div>
                </div>

                <!-- Броня -->
                <div class="section" id="armorSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3531-3730-4631-a438-353361653361/bulletproof-vest.png" alt="🛡️" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Броня</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showArmorShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить броню</button>
                        </div>
                        <div style="display: grid; gap: 0.5rem;">
                            <!-- Голова -->
                            <div style="display: grid; grid-template-columns: 80px 1fr 1.5fr; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Голова:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorHeadOS" value="0" min="0" max="99" onchange="state.armor.head.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('head')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;">Тип:</span>
                                    <select class="input-field" id="armorHeadType" onchange="state.armor.head.type = this.value; scheduleSave(); updateArmorPenalty();" style="padding: 0.4rem;">
                                        <option value="Лёгкая">Лёгкая 10 ОС</option>
                                        <option value="Средняя">Средняя 15 ОС</option>
                                        <option value="Тяжёлая">Тяжёлая 18 ОС</option>
                                        <option value="Титаническая">Титаническая 25 ОС</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Тело -->
                            <div style="display: grid; grid-template-columns: 80px 1fr 1.5fr; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Тело:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorBodyOS" value="0" min="0" max="99" onchange="state.armor.body.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('body')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;">Тип:</span>
                                    <select class="input-field" id="armorBodyType" onchange="state.armor.body.type = this.value; scheduleSave(); updateArmorPenalty();" style="padding: 0.4rem;">
                                        <option value="Лёгкая">Лёгкая 10 ОС</option>
                                        <option value="Средняя">Средняя 15 ОС</option>
                                        <option value="Тяжёлая">Тяжёлая 18 ОС</option>
                                        <option value="Титаническая">Титаническая 25 ОС</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Руки -->
                            <div style="display: grid; grid-template-columns: 80px 1fr 1.5fr; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Руки:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorArmsOS" value="0" min="0" max="99" onchange="state.armor.arms.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('arms')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;">Тип:</span>
                                    <select class="input-field" id="armorArmsType" onchange="state.armor.arms.type = this.value; scheduleSave(); updateArmorPenalty();" style="padding: 0.4rem;">
                                        <option value="Лёгкая">Лёгкая 10 ОС</option>
                                        <option value="Средняя">Средняя 15 ОС</option>
                                        <option value="Тяжёлая">Тяжёлая 18 ОС</option>
                                        <option value="Титаническая">Титаническая 25 ОС</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Ноги -->
                            <div style="display: grid; grid-template-columns: 80px 1fr 1.5fr; gap: 0.75rem; align-items: center;">
                                <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Ноги:</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;" title="Останавливающая Сила">ОС:</span>
                                    <input type="text" class="input-field" id="armorLegsOS" value="0" min="0" max="99" onchange="state.armor.legs.os = parseInt(this.value); scheduleSave(); updateArmorPenalty();" style="width: 60px; padding: 0.4rem; text-align: center;">
                                    <button onclick="decreaseArmorOS('legs')" style="background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.2rem; padding: 0; margin-left: 0.25rem;" title="Уменьшить ОС">▼</button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="color: var(--muted); font-size: 0.8rem;">Тип:</span>
                                    <select class="input-field" id="armorLegsType" onchange="state.armor.legs.type = this.value; scheduleSave(); updateArmorPenalty();" style="padding: 0.4rem;">
                                        <option value="Лёгкая">Лёгкая 10 ОС</option>
                                        <option value="Средняя">Средняя 15 ОС</option>
                                        <option value="Тяжёлая">Тяжёлая 18 ОС</option>
                                        <option value="Титаническая">Титаническая 25 ОС</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Штраф от брони -->
                            <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(255, 91, 135, 0.1); border: 1px solid var(--danger); border-radius: 8px;">
                                <div style="color: var(--danger); font-size: 0.8rem; font-weight: 600; margin-bottom: 0.5rem;">Штраф от брони:</div>
                                <div id="armorPenaltyText" style="color: var(--text); font-family: monospace; font-size: 0.75rem; line-height: 1.4;">Без штрафа</div>
                            </div>
                            
                            <!-- Наративное описание брони -->
                            <div style="margin-top: 1rem;">
                                <label class="input-label" style="display: block; margin-bottom: 0.5rem;">ОПИСАНИЕ БРОНИ</label>
                                <textarea class="input-field" id="armorDescription" placeholder="Опишите, что надето на персонаже..." onchange="state.armor.description = this.value; scheduleSave();" style="min-height: 80px; resize: vertical;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Киберимпланты -->
                <div class="section" id="implantsSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3864-3638-4361-b139-616436373366/woman.png" alt="🦾" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Киберимпланты</h3>
                    </div>
                    <div class="section-content expanded">
                        <div id="implantsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Киберимпланты не установлены</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
                            <button class="pill-button primary-button" onclick="showImplantShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить модуль</button>
                            <button class="pill-button" onclick="showImplantPartsShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить часть импланта</button>
                            <button class="pill-button" onclick="showImplantsManagement()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Управление имплантами</button>
                        </div>
                    </div>
                </div>

                <!-- Дека -->
                <div class="section" id="deckSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3633-6632-4463-a435-353036636235/live-streaming.png" alt="💾" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Дека</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem; padding: 0 1rem;">
                        <button class="pill-button primary-button" onclick="showProgramShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить программу</button>
                        <button class="pill-button success-button" onclick="showDeckShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">💻 Магазин Дек</button>
                        <button class="pill-button warning-button" onclick="showDeckGearShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">🔧 Снаряжение</button>
                        <button class="pill-button" onclick="showDeckCollection()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">📚 Мои Деки</button>
                    </div>
                    <div class="section-content expanded">
                        <!-- Щепки памяти - сворачиваемая секция -->
                        <div>
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.5rem; background: rgba(182, 103, 255, 0.1); border: 1px solid var(--accent); border-radius: 8px; cursor: pointer;" onclick="toggleDeckSection('chips')">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span id="deckChipsToggle" style="color: var(--accent); font-size: 0.8rem;">▼</span>
                                    <span style="color: var(--accent); font-weight: 600; font-size: 0.9rem;">Щепки памяти</span>
                                    <span id="deckChipsCount" style="color: var(--muted); font-size: 0.8rem;">(0)</span>
                                </div>
                                <button class="pill-button" onclick="event.stopPropagation(); addMemoryChip()" style="font-size: 0.7rem; padding: 0.2rem 0.5rem;">Добавить щепку</button>
                            </div>
                            <div id="deckChipsContainer" style="margin-top: 0.5rem;">
                                <p style="color: var(--muted); text-align: center; padding: 1rem; font-size: 0.8rem;">Щепки памяти не добавлены</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Снаряжение -->
                <div class="section" id="gearSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3363-6531-4132-a138-663132646531/remote-control.png" alt="🎒" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Снаряжение</h3>
                    </div>
                    <div class="section-content expanded">
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <button class="pill-button primary-button" onclick="showGearShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить снаряжение</button>
                            <button class="pill-button success-button" onclick="pickupGear()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Подобрать с пола</button>
                        </div>
                        <div style="background: rgba(91, 155, 255, 0.1); border: 1px solid #5b9bff; border-radius: 8px; padding: 0.75rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; white-space: nowrap;">
                                <span style="color: var(--text);">Нагрузка:</span>
                                <span style="color: var(--accent); font-weight: 600;"><span id="currentLoad">25</span> / <span id="maxLoad">25</span></span>
                            </div>
                            <div style="display: flex; justify-content: center; margin-bottom: 0.5rem;">
                                <button class="pill-button muted-button" onclick="resetLoad()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Сбросить нагрузку</button>
                            </div>
                            <div id="loadWarning" style="color: var(--danger); font-size: 0.9rem; margin-top: 0.5rem; display: none;"></div>
                        </div>
                        <div id="gearContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Снаряжение не добавлено</p>
                        </div>
                    </div>
                </div>

                <!-- Препараты -->
                <div class="section" id="drugsSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild3532-3565-4033-a136-653464353038/drugs.png" alt="💊" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Препараты</h3>
                        <button class="pill-button primary-button" onclick="showDrugsShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить препараты</button>
                    </div>
                    <div class="section-content expanded">
                        <div id="drugsContainer">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Препараты не добавлены</p>
                        </div>
                    </div>
                </div>

                <!-- Собственность -->
                <div class="section" id="propertySection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6361-6565-4764-b437-306433303764/car-check_1.png" alt="🏠" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Собственность</h3>
                    </div>
                    <div class="section-content expanded">
                        <!-- Жилье -->
                        <div class="property-subsection">
                            <div class="section-subtitle">Жилье</div>
                            <div id="housingContainer">
                                <p style="color: var(--muted); text-align: center; padding: 1rem;">Жилье не добавлено</p>
                            </div>
                            <button class="pill-button" onclick="addHousing()">Добавить жилье</button>
                        </div>

                        <!-- Транспорт -->
                        <div class="property-subsection">
                            <div class="section-subtitle">Транспорт</div>
                            <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                                <button class="pill-button primary-button" onclick="showVehicleShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить транспорт</button>
                                <button class="pill-button success-button" onclick="showVehicleModulesShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Купить модули</button>
                            </div>
                            <div id="vehiclesContainer">
                                <p style="color: var(--muted); text-align: center; padding: 1rem;">Транспорт не добавлен</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Скупщик -->
                <div class="section" id="fenceSection">
                    <div class="section-header">
                        <h3 class="section-title"><img src="https://static.tildacdn.com/tild6630-3835-4431-b030-326266363466/seafood.png" alt="🦞" style="width: 24px; height: 24px; margin-right: 0.5rem;"> Скупщик</h3>
                        <button class="pill-button success-button" onclick="showFenceShop()" style="font-size: 0.8rem; padding: 0.3rem 0.6rem;">Продать вещи</button>
                    </div>
                    <div class="section-content expanded">
                        <div style="padding: 1rem; background: rgba(125, 244, 198, 0.05); border: 1px solid rgba(125, 244, 198, 0.2); border-radius: 8px; margin-bottom: 1rem;">
                            <p style="color: var(--text); font-size: 0.85rem; line-height: 1.5; margin: 0;">
                                <strong style="color: var(--success);">Скупщик</strong> покупает почти всё по сниженной цене.<br>
                                <span style="color: var(--muted); font-size: 0.8rem;"><img src="https://static.tildacdn.com/tild3235-6133-4838-b966-303966353032/stop.png" alt="❌" style="width: 16px; height: 16px; vertical-align: middle;"> Не покупает: броню, транспорт и медикаменты</span>
                            </p>
                        </div>
                        <div id="fenceHistory" style="max-height: 300px; overflow-y: auto;">
                            <p style="color: var(--muted); text-align: center; padding: 2rem;">Ещё ничего не продано</p>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <!-- Плавающая кнопка бросалки кубов -->
    <div class="dice-button" id="diceButton" onclick="showUniversalDiceModal()" style="position: fixed; bottom: 180px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild6461-3139-4934-a463-333563633064/dice.png" alt="&#x1F3B2;" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающая кнопка заметок -->
    <div class="notes-button" id="notesButton" onclick="showNotesModal()" style="position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <span style="font-size: 1.5rem; color: var(--bg); font-weight: bold;">&#x1F4DD;</span>
    </div>

    <!-- Плавающая кнопка логов -->
    <div class="log-button" id="logButton" onclick="showFloatingLog()" style="position: fixed; bottom: 100px; left: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; transition: all 0.3s ease; border: 2px solid #2a3d4f;">
        <img src="https://static.tildacdn.com/tild3432-3537-4564-a261-623265663130/log-data.png" alt="📡" style="width: 32px; height: 32px;">
    </div>

    <!-- Плавающий блок логов -->
    <div class="floating-log-window" id="floatingLogWindow" style="position: fixed; top: 100px; right: 20px; width: 400px; height: 500px; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 12px; box-shadow: 0 8px 32px rgba(19, 31, 42, 0.8); z-index: 999; border: 2px solid #2a3d4f; display: flex; flex-direction: column; resize: both; overflow: hidden; min-width: 300px; min-height: 200px; max-width: 90vw; max-height: 90vh;">
        <!-- Заголовок (для перетаскивания) -->
        <div class="floating-log-header" id="floatingLogHeader" style="background: linear-gradient(135deg, #1a2633, #213040); padding: 0.75rem 1rem; border-bottom: 1px solid #2a3d4f; cursor: move; display: flex; justify-content: space-between; align-items: center; user-select: none;">
            <span style="color: #00ffff; font-weight: 600; font-size: 0.9rem;">📡 ЛОГ ТВОЕЙ ЖИЗНИ</span>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="clearRollLog()" style="background: transparent; border: none; color: #ff5b87; cursor: pointer; font-size: 0.8rem; padding: 0.2rem 0.5rem; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,91,135,0.2)'" onmouseout="this.style.background='transparent'">Очистить</button>
                <button onclick="hideFloatingLog()" style="background: transparent; border: none; color: #00ffff; cursor: pointer; font-size: 1.2rem; line-height: 1; padding: 0;" title="Скрыть">×</button>
            </div>
        </div>
        <!-- Контент -->
        <div id="floatingLogContent" style="flex: 1; overflow-y: auto; padding: 0.5rem; font-size: 0.85rem; line-height: 1.4;">
            <p style="color: #5a7a8a; text-align: center; padding: 2rem;">Лог бросков пуст</p>
        </div>
    </div>

    <!-- Свернутый блок логов (трей) -->
    <div class="minimized-log" id="minimizedLog" onclick="toggleFloatingLog()" style="display: none; position: fixed; bottom: 180px; left: 20px; padding: 0.5rem 1rem; background: linear-gradient(135deg, #131f2a, #1a2633); border-radius: 20px; cursor: pointer; box-shadow: 0 4px 20px rgba(19, 31, 42, 0.6); z-index: 1000; border: 2px solid #2a3d4f; transition: all 0.3s ease;">
        <span style="color: #00ffff; font-weight: 600; font-size: 0.85rem;">📡 ЛОГ</span>
    </div>

    <!-- Подключение JavaScript файлов -->
    <!-- ВАЖНО: Порядок подключения имеет значение! -->
    <script src="data.js?v=20241220"></script>     <!-- Сначала данные -->
    <script src="utils.js?v=20241220"></script>    <!-- Затем утилиты -->
    <script src="scripts.js?v=20241220"></script>  <!-- В конце основные функции -->
    <script src="fence.js?v=20241220"></script>    <!-- Функции скупщика -->
    <script src="bargain-purchase.js?v=20241220"></script>  <!-- Система торга при покупке -->
    
    <script>
        // Инициализация приложения после загрузки DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('%c EZY: Cyber Character Sheet ', 'background: #b667ff; color: #0a0712; font-weight: bold; padding: 4px;');
            
            // Проверяем загрузку всех компонентов
            if (typeof STANDARD_SKILLS !== 'undefined') {
                console.log('✓ Data.js загружен');
            } else {
                console.error('✗ Data.js НЕ загружен! Проверьте data.js');
            }
            
            if (typeof saveState === 'function') {
                console.log('✓ Utils.js загружен');
            } else {
                console.error('✗ Utils.js НЕ загружен! Проверьте utils.js');
            }
            
            if (typeof renderSkills === 'function') {
                console.log('✓ Scripts.js загружен');
            } else {
                console.error('✗ Scripts.js НЕ загружен! Проверьте scripts.js');
            }
            
            // Запускаем приложение
            try {
                if (typeof loadState === 'function') {
                    loadState();
                }
                
                if (typeof detectTouchDevice === 'function') {
                    detectTouchDevice();
                }
                
                if (typeof initializeNumericInputs === 'function') {
                    initializeNumericInputs();
                }
                
                if (typeof initializeProfessionalSkillsTextareas === 'function') {
                    initializeProfessionalSkillsTextareas();
                }
                
                // Запускаем загрузочный экран
                if (typeof startLoadingAnimation === 'function') {
                    startLoadingAnimation();
                }
                
                console.log('✓ Приложение инициализировано успешно!');
            } catch (error) {
                console.error('✗ Ошибка инициализации:', error);
            }
        });
    </script>
</body>
</html>